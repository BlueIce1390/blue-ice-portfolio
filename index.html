<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blue Ice</title>
    
    <!-- Fonts: Montserrat (Main) & VT323 (Subtle accents) -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=VT323&display=swap" rel="stylesheet">
    
    <!-- NEW: Markdown Parser Library -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* --- 1. THEME CONFIGURATION --- */
        :root {
            --bg-deep: #f0f9ff;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --accent-cyan: #0891b2;  
            --accent-blue: #2563eb;
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: rgba(0, 0, 0, 0.05);
            --glass-highlight: rgba(255, 255, 255, 0.8);
            --glass-blur: blur(25px);
            --shadow-card: 0 4px 15px rgba(0, 0, 0, 0.05);
            --orb-opacity: 0.15;
            --font-pixel: 'VT323', monospace;
            --font-main: 'Montserrat', sans-serif;
            --error-red: #dc2626;
            --warning-yellow: #eab308;
        }

        body[data-theme="dark"] {
            --bg-deep: #020617;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent-cyan: #22d3ee;  
            --accent-blue: #3b82f6;
            --glass-bg: rgba(15, 23, 42, 0.65);
            --glass-border: rgba(255, 255, 255, 0.15);
            --glass-highlight: rgba(255, 255, 255, 0.05);
            --shadow-card: 0 4px 6px rgba(0, 0, 0, 0.1);
            --orb-opacity: 0.3;
        }

        /* --- 2. CORE SETUP --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            background-color: var(--bg-deep);
            animation: blueShift 20s ease-in-out infinite;
            color: var(--text-primary);
            font-family: var(--font-main);
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            cursor: default;
            line-height: 1.6;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        /* --- 3. BACKGROUND FX --- */
        .bg-mesh {
            position: fixed;
            top: -50%; left: -50%; width: 200%; height: 200%;
            z-index: -3;
            background: radial-gradient(circle at 50% 50%, transparent 0%, rgba(0,0,0,0.2) 100%);
            background-size: 200% 200%;
            pointer-events: none;
        }

        .bg-orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(100px);
            z-index: -2;
            opacity: var(--orb-opacity);
            transition: opacity 0.5s ease;
            animation: floatOrb 20s infinite ease-in-out;
        }
        .orb-1 { top: 10%; left: 10%; width: 500px; height: 500px; background: var(--accent-blue); animation-delay: 0s; }
        .orb-2 { bottom: 10%; right: 10%; width: 400px; height: 400px; background: var(--accent-cyan); animation-delay: -8s; }

        #particle-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; pointer-events: none;
            opacity: 0.6;
        }

        @keyframes floatOrb {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(30px, -30px); }
        }

        /* --- 4. GLASS UTILITIES & TILT --- */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-top: 1px solid var(--glass-highlight);
            box-shadow: var(--shadow-card);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            transition: background 0.3s ease, border 0.3s ease;
        }

        .tilt-card {
            transform-style: preserve-3d;
            perspective: 1000px;
            transform: perspective(1000px) rotateX(0) rotateY(0) scale(1);
            transition: transform 0.1s ease-out;
        }

        /* --- 5. NAVIGATION --- */
        .top-bar {
            position: sticky; top: 0; z-index: 100;
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px 40px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            transition: background 0.3s ease;
        }

        .logo {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;  
            font-size: 1.5rem;  
            color: var(--text-primary);
            text-decoration: none;
            cursor: pointer;
            letter-spacing: -0.5px;
        }

        .nav-links { display: flex; gap: 30px; }
        .nav-links a {
            text-decoration: none; color: var(--text-secondary);
            font-weight: 500; font-size: 0.95rem;  
            transition: 0.2s; position: relative;
            cursor: pointer;
        }
        .nav-links a:hover, .nav-links a.active { color: var(--text-primary); }
        .nav-links a::after {
            content: ''; position: absolute; bottom: -4px; left: 0; width: 0%; height: 2px;
            background: var(--accent-cyan); transition: width 0.3s;
        }
        .nav-links a:hover::after, .nav-links a.active::after { width: 100%; }

        .nav-controls { display: flex; align-items: center; gap: 15px; }

        .theme-toggle-btn {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            width: 36px; height: 36px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: 0.3s;
            font-size: 1.1rem;
        }

        .theme-toggle-btn:hover { background: var(--glass-highlight); color: var(--accent-cyan); border-color: var(--accent-cyan); }

        /* --- 6. LAYOUT (UPDATED FOR WIDER VIEW) --- */
        .container {
            /* Changed from 1600px to 95vw to be much wider on desktop */
            max-width: 95vw; 
            width: 1800px; /* Cap at 1800px just in case of ultra-wide monitors */
            margin: 40px auto;
            display: grid; grid-template-columns: 1fr 280px; /* Main Content | Global Sidebar */
            gap: 40px; padding: 0 30px; flex-grow: 1;
        }
        
        main { min-width: 0; }

        @media (max-width: 900px) {
            .container { grid-template-columns: 1fr; width: 100%; max-width: 100%; }
            .top-bar { padding: 15px 20px; }
            .nav-links { display: none; }
        }

        /* --- 7. PAGES & COMPONENTS --- */
        .page-section { display: none; animation: fadeIn 0.8s ease; }
        .page-section.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header-pill {
            display: inline-block;
            background: var(--accent-blue);
            color: #fff;
            padding: 6px 15px;
            border-radius: 9999px; /* Pill shape */
            font-weight: 700;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
            margin-bottom: 25px;
            text-transform: uppercase;
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3); /* Subtle blue shadow */
        }
        
        h1 { font-size: 2.5rem; font-weight: 800; line-height: 1.2; margin-bottom: 10px; color: var(--text-primary); }
        h2 { font-size: 1.8rem; font-weight: 700; margin-bottom: 15px; color: var(--text-primary); }
        h3 { font-size: 1.2rem; font-weight: 600; color: var(--text-primary); }
        
        .btn-ice {
            background: transparent;
            border: 1px solid var(--text-secondary);
            color: var(--text-primary);
            padding: 8px 20px;
            font-family: var(--font-main);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            border-radius: 6px;
        }
        .btn-ice:hover {  
            border-color: var(--accent-cyan);  
            color: var(--accent-cyan);  
            background: rgba(34, 211, 238, 0.1);
        }

        /* --- 8. PROJECTS PAGE --- */
        .projects-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .project-card-video { padding: 20px; cursor: pointer; }
        .video-container {
            position: relative; width: 100%; padding-top: 56.25%; 
            margin-bottom: 15px; border-radius: 6px; overflow: hidden;
            border: 1px solid var(--glass-border); background: var(--glass-highlight);
        }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        @media (max-width: 700px) { .projects-grid { grid-template-columns: 1fr; } }

        /* --- 9. INFINITE MARQUEE --- */
        .marquee-container {
            width: 100%; overflow: hidden; position: relative;
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: 12px; padding: 20px 0; margin-bottom: 30px;
            box-shadow: var(--shadow-card);
        }
        .marquee-track { display: flex; gap: 20px; width: max-content; animation: scroll 89s linear infinite; }
        .marquee-item {
            width: 400px;  
            height: 87px;  
            flex-shrink: 0;
            background: var(--glass-highlight); border-radius: 8px;
            border: 1px solid var(--glass-border); overflow: hidden;
            display: flex; align-items: center; justify-content: center;
        }

        .marquee-item img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease; }
        .marquee-item img:hover { transform: scale(1.05); }
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

        /* --- 10. BLOG LAYOUT & READER --- */
        .blog-internal-layout {
            /* UPDATED: Left column fixed at 250px, right column takes ALL remaining space (1fr) */
            display: grid;
            grid-template-columns: 250px 1fr; 
            gap: 40px;
        }

        .blog-sidebar-widget { margin-bottom: 20px; }
        
        .profile-card { padding: 20px; text-align: center; }
        .profile-img-container {
            width: 100px; height: 100px;
            margin: 0 auto 10px auto;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid var(--glass-border);
            background: var(--glass-highlight);
        }
        .profile-img-container img { width: 100%; height: 100%; object-fit: contain; }
        .profile-name { font-weight: 800; font-size: 1.1rem; color: var(--text-primary); }
        .profile-bio { font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px; line-height: 1.4; }
        
        .social-row { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }
        .social-icon {
            width: 28px; height: 28px;
            background: var(--glass-highlight);
            border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; color: var(--text-secondary);
            cursor: pointer; transition: 0.2s;
        }
        .social-icon:hover { background: var(--accent-cyan); color: #000; }

        .cat-list { list-style: none; margin-top: 10px; }
        .cat-item {
            display: flex; justify-content: space-between;
            padding: 6px 0; border-bottom: 1px solid var(--glass-border);
            font-size: 0.85rem; color: var(--text-secondary); cursor: pointer;
        }
        .cat-item:hover { color: var(--accent-cyan); }
        .cat-count { background: var(--glass-highlight); padding: 1px 6px; border-radius: 4px; font-size: 0.75rem; }

        /* Blog Feed List Styles */
        .post-card-horiz {
            display: flex;
            justify-content: space-between;
            padding: 25px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: transform 0.2s;
            gap: 20px;
        }
        .post-card-horiz:hover { transform: translateY(-3px); border-color: var(--accent-cyan); }

        .post-info { flex: 1; display: flex; flex-direction: column; }
        
        .post-meta-row {
            display: flex; align-items: center; gap: 10px;
            font-size: 0.75rem; color: var(--text-secondary);
            margin-bottom: 10px; font-family: var(--font-main);
        }
        .meta-tag {  
            background: rgba(34, 211, 238, 0.1); color: var(--accent-cyan);  
            padding: 2px 8px; border-radius: 4px; font-weight: 600;
        }

        .post-title-lg { font-size: 1.4rem; font-weight: 700; color: var(--text-primary); line-height: 1.3; margin-bottom: 10px; }
        .post-excerpt-sm {
            font-size: 0.9rem; color: var(--text-secondary);
            line-height: 1.6; margin-bottom: 15px;
            display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;
        }
        .post-stats { font-size: 0.75rem; color: var(--text-secondary); opacity: 0.7; }
        .post-thumb-rect {
            width: 200px; height: 140px;
            background: var(--glass-highlight);
            border-radius: 8px;
            flex-shrink: 0;
            overflow: hidden;
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; border: 1px solid var(--glass-border);
        }
        
        /* Updated Post Thumb for Images */
        .post-thumb-rect img {
            width: 100%; height: 100%; object-fit: cover;
        }

        /* --- BLOG READER VIEW --- */
        #blog-reader { display: none; animation: fadeIn 0.5s ease; }
        .reader-header { margin-bottom: 30px; border-bottom: 1px solid var(--glass-border); padding-bottom: 20px; }
        .reader-title { font-size: 2.2rem; font-weight: 800; margin-bottom: 15px; color: var(--text-primary); }
        .reader-meta { font-size: 0.85rem; color: var(--text-secondary); display: flex; gap: 15px; align-items: center; }
        .reader-content { font-size: 1.05rem; line-height: 1.8; color: var(--text-primary); }
        
        /* MARKDOWN ELEMENT STYLING */
        .reader-content p { margin-bottom: 20px; }
        .reader-content h1, 
        .reader-content h2, 
        .reader-content h3, 
        .reader-content h4 { 
            margin-top: 30px; margin-bottom: 15px; color: var(--text-primary); font-weight: 700;
        }
        .reader-content h1 { font-size: 1.8rem; border-bottom: 1px solid var(--glass-border); padding-bottom: 10px; }
        .reader-content h2 { font-size: 1.5rem; color: var(--accent-cyan); }
        .reader-content h3 { font-size: 1.25rem; }
        
        .reader-content ul, .reader-content ol { margin-bottom: 20px; padding-left: 25px; }
        .reader-content li { margin-bottom: 8px; color: var(--text-secondary); }
        .reader-content strong { color: var(--text-primary); font-weight: 700; }
        .reader-content blockquote {
            border-left: 4px solid var(--accent-cyan);
            padding-left: 15px; margin: 20px 0;
            font-style: italic; color: var(--text-secondary);
        }
        
        /* --- AUTOMATIC IMAGE STYLING --- */
        .reader-content img {
            max-width: 100%; height: auto; border-radius: 8px;
            margin: 25px auto; display: block;
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* New Hero Image Style */
        .reader-cover-img {
            width: 100%; height: 350px; object-fit: cover; border-radius: 8px;
            margin-bottom: 30px; border: 1px solid var(--glass-border);
            display: none; /* Hidden by default if no image */
        }

        /* Comments Section */
        .comments-section { margin-top: 50px; border-top: 1px solid var(--glass-border); padding-top: 30px; }
        .comments-header { font-size: 1.2rem; font-weight: 700; margin-bottom: 20px; }
        .comment-list { margin-bottom: 30px; }
        .comment-item { 
            background: var(--glass-highlight); border: 1px solid var(--glass-border);
            padding: 15px; border-radius: 8px; margin-bottom: 15px;
        }
        .comment-user { font-weight: 700; color: var(--accent-cyan); font-size: 0.9rem; margin-bottom: 5px; }
        .comment-text { font-size: 0.95rem; color: var(--text-primary); }
        .comment-time { font-size: 0.7rem; color: var(--text-secondary); margin-top: 8px; text-align: right;}

        .comment-form { display: none; } /* Hidden by default until login */
        .login-prompt { background: rgba(37, 99, 235, 0.1); padding: 20px; text-align: center; border-radius: 8px; color: var(--text-primary); }

        @media (max-width: 768px) {
            .blog-internal-layout { grid-template-columns: 1fr; }
            .post-card-horiz { flex-direction: column-reverse; }
            .post-thumb-rect { width: 100%; height: 180px; }
            .reader-cover-img { height: 200px; }
        }

        /* --- 11. SIDEBAR WIDGETS --- */
        .sidebar-widget { padding: 25px; margin-bottom: 25px; }
        .sidebar-header {
            font-family: var(--font-main); font-weight: 700; font-size: 0.85rem;
            text-transform: uppercase; letter-spacing: 1px; color: var(--accent-cyan);
            margin-bottom: 15px; border-bottom: 1px solid var(--glass-border); padding-bottom: 8px;
        }
        .char-display {
            width: 100%; height: 250px; overflow: hidden; border-radius: 8px; 
            position: relative; background: var(--glass-highlight); border: 1px solid var(--glass-border);
        }
        .char-display img { width: 100%; height: 100%; object-fit: cover; object-position: center top; }

        /* --- 12. MISC --- */
        input, textarea {
            width: 100%; padding: 10px; background: var(--glass-highlight);
            border: 1px solid var(--glass-border); color: var(--text-primary);
            border-radius: 4px; margin-bottom: 10px; font-family: var(--font-main);
        }
        input:focus { outline: none; border-color: var(--accent-cyan); }

        #boot-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-deep); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 1s ease-out; color: var(--text-primary);
        }
        
        .pixel-list li {
            list-style: none; margin-bottom: 8px; font-size: 0.9rem;
            display: flex; align-items: center; gap: 8px; cursor: pointer;
            transition: 0.2s; color: var(--text-secondary);
        }
        .pixel-list li:hover { color: var(--text-primary); transform: translateX(5px); }
        .px-icon { width: 6px; height: 6px; background: var(--accent-cyan); display: inline-block; }

        /* Login Page Specifics */
        .login-card { max-width: 450px; margin: 50px auto; padding: 40px; text-align: center; }
        
        /* Google Button Style */
        .btn-google {
            background: #fff; color: #444; border: 1px solid #ddd;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            width: 100%; padding: 10px; border-radius: 6px; cursor: pointer;
            font-family: var(--font-main); font-weight: 600; font-size: 0.9rem;
            transition: 0.2s; margin-bottom: 15px;
        }
        .btn-google:hover { background: #f1f5f9; }
        .google-icon { width: 18px; height: 18px; }

        @keyframes blueShift {
            0% { background-color: #e0f4ff; }
            50% { background-color: #b3e0ff; }
            100% { background-color: #e0f4ff; }
        }

        body[data-theme="dark"] { animation: blueShiftDark 20s ease-in-out infinite; }
        @keyframes blueShiftDark {
            0% { background-color: #081122; }
            50% { background-color: #0d1a33; }
            100% { background-color: #081122; }
        }

        /* --- Custom Message Box --- */
        #message-box {
            position: fixed; bottom: 20px; right: 20px;
            background: var(--accent-blue); color: #fff;
            padding: 15px 25px; border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 9999; display: none;
            transition: opacity 0.5s ease, background 0.3s ease;
            max-width: 300px; font-weight: 600;
        }

        /* --- Custom Confirmation Modal --- */
        .custom-modal-backdrop {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5); z-index: 10000;
            display: none; justify-content: center; align-items: center;
        }
        .custom-modal-content {
            background: var(--glass-bg); padding: 30px; border-radius: 12px;
            box-shadow: var(--shadow-card); max-width: 400px;
            border: 1px solid var(--glass-border);
        }
    </style>
</head>
<body>

    <!-- IMPORTANT: Check saved theme immediately to prevent flash -->
    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
            }
        })();
    </script>

    <!-- Audio (Hidden) -->
    <audio id="bg-music" loop><source src="" type="audio/mpeg"></audio>

    <!-- BACKGROUND FX -->
    <div class="bg-mesh"></div>
    <div class="bg-orb orb-1"></div>
    <div class="bg-orb orb-2"></div>
    <canvas id="particle-canvas"></canvas>

    <!-- CUSTOM MESSAGE BOX -->
    <div id="message-box"></div>

    <!-- CUSTOM CONFIRM MODAL -->
    <div id="confirm-modal" class="custom-modal-backdrop">
        <div class="custom-modal-content">
            <div id="confirm-message" style="margin-bottom: 20px; font-weight: 600;"></div>
            <div style="display: flex; justify-content: flex-end; gap: 10px;">
                <button class="btn-ice" onclick="confirmCallback(false)">Cancel</button>
                <button class="btn-ice" style="background: var(--warning-yellow); border-color: var(--warning-yellow);" onclick="confirmCallback(true)">Confirm</button>
            </div>
        </div>
    </div>


    <!-- BOOT SCREEN -->
    <div id="boot-screen">
        <div style="font-weight: 800; font-size: 2rem; letter-spacing: 2px;">Blue Ice</div>
        <div style="margin-top: 10px; font-size: 0.8rem; color: var(--text-secondary);">ESTABLISHING CONNECTION...</div>
        <div style="width: 200px; height: 2px; background: var(--glass-border); margin-top: 20px;">
            <div id="boot-bar" style="width: 0%; height: 100%; background: var(--accent-cyan); transition: width 0.1s;"></div>
        </div>
    </div>

    <!-- NAVIGATION -->
    <nav class="top-bar">
        <div class="logo" onclick="showPage('home')">Blue Ice</div>
        <div class="nav-links">
            <!-- FIXED: Added preventDefault to allow JS routing -->
            <a href="/" onclick="event.preventDefault(); showPage('home')" id="nav-home" class="active">Home</a>
            <a href="/projects" onclick="event.preventDefault(); showPage('projects')" id="nav-projects">Projects</a>
            <a href="/blog" onclick="event.preventDefault(); showPage('blog')" id="nav-blog">Blog</a>
            <a href="/contact" onclick="event.preventDefault(); showPage('contact')" id="nav-contact">Contact</a>
        </div>
        <div class="nav-controls">
            <button class="theme-toggle-btn" onclick="toggleTheme()" title="Toggle Theme">‚òæ</button>
            <button id="nav-login-btn" class="btn-ice" style="padding: 6px 16px; font-size: 0.8rem;" onclick="showPage('login')">Login</button>
        </div>
    </nav>

    <!-- MAIN CONTAINER -->
    <div class="container">
        
        <!-- MAIN CONTENT AREA -->
        <main>
            <!-- HOME TAB -->
            <div id="home" class="page-section active">
                <div class="glass tilt-card" style="padding: 40px; margin-bottom: 30px;">
                    <h1 id="typewriter"></h1>
                    <p style="font-size: 1.1rem; color: var(--accent-cyan); margin-bottom: 20px;">College Student. Video Editor. Cool Guy.</p>
                    <p style="color: var(--text-secondary); max-width: 600px;">
                        Welcome to my personal corner of the web. I am a 17 year old college student who also makes video essays. This website is a home for my projects and blog. Feel free to contact me if you want to work together!
                    </p>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="glass tilt-card" style="padding: 25px;">
                        <h3>Latest</h3>
                        <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);">WEBSITE IS LIVE!!!!!</p>
                    </div>
                    <div class="glass tilt-card" style="padding: 25px;">
                        <h3>Status</h3>
                        <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);">Vibe Coding</p>
                    </div>
                </div>
            </div>

            <!-- PROJECTS TAB -->
            <div id="projects" class="page-section">
                <h2 style="margin-bottom: 30px;">Featured Works</h2>
                <div class="projects-grid" id="projects-grid">
                    <!-- Projects injected here via JS -->
                    <div style="text-align:center; padding:20px;">Loading Projects from Database...</div>
                </div>

                <hr style="border-top: 1px solid var(--glass-border); margin: 50px 0;">

                <!-- INFINITE MARQUEE SECTION -->
                <div class="section-header-pill">Client Love</div>
                <h2 style="margin-bottom: 25px;">What Others Say</h2>
                
                <div class="marquee-container">
                    <div class="marquee-track" id="marquee-track">
                        <!-- JS Injected Images -->
                    </div>
                </div>

                <!-- CTA -->
                <div class="glass tilt-card" style="padding: 40px; text-align: center; margin-top: 30px;">
                    <h3 style="margin-bottom: 15px; font-size: 1.6rem;">Like what you see?</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 25px; max-width: 500px; margin-left: auto; margin-right: auto;">
                        Let's build something amazing together. I'm currently accepting new projects.
                    </p>
                    <button class="btn-ice" style="padding: 12px 35px; font-size: 1rem; background: var(--accent-cyan); color: #fff; border: none;" onclick="showPage('contact')">Start a Project ‚Üí</button>
                </div>
            </div>

            <!-- BLOG TAB WITH READER & COMMENTS -->
            <div id="blog" class="page-section">
                <div class="blog-internal-layout">
                    
                    <!-- Left Sidebar (Internal) -->
                    <div class="blog-left-sidebar">
                        <div class="glass blog-sidebar-widget profile-card">
                            <div class="profile-img-container">
                                <img src="squarewebsitepic.png" alt="Profile" onerror="this.onerror=null;this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxNTAiIGZpbGw9IiNjY2MiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSI1MCI+8J+Rüë§PC90ZXh0Pjwvc3ZnPg==';">
                            </div>
                            <div class="profile-name">Archan Bhatt</div>
                            <div class="profile-bio">Just some guy with opinions and thoughts.</div>
                        </div>
                        <div class="glass blog-sidebar-widget" style="padding: 20px;">
                            <div class="sidebar-header" style="border:none; margin-bottom:10px;">Categories</div>
                            <ul class="cat-list">
                                <li class="cat-item"><span>Guide</span> <span class="cat-count">1</span></li>
                                <li class="cat-item"><span>Personal</span> <span class="cat-count">1</span></li>
                                <li class="cat-item"><span>School</span> <span class="cat-count">0</span></li>
                                <li class="cat-item"><span>Youtube</span> <span class="cat-count">0</span></li>

                            </ul>
                        </div>
                    </div>

                    <!-- Right Feed & Reader Container -->
                    <div class="blog-main-area">
                        <h2 style="margin-bottom: 20px;">Journal</h2>
                        
                        <!-- 1. BLOG LIST VIEW (Visible by default) -->
                        <div id="blog-list">
                            <!-- Posts are injected here via JS -->
                            <div style="text-align:center; padding:20px;">Loading Posts from Database...</div>
                        </div>

                        <!-- 2. BLOG READER VIEW (Hidden by default) -->
                        <div id="blog-reader" class="glass" style="padding: 40px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <!-- CHANGED: Use specific helper function to guarantee return -->
                                <button onclick="goBackToJournal()" class="btn-ice">‚Üê Back to Journal</button>
                                <button onclick="toggleSavePost()" id="btn-save-post" class="btn-ice">‚ù§Ô∏è Save</button>
                            </div>
                            
                            <img id="reader-cover" class="reader-cover-img" src="" alt="Cover">

                            <div class="reader-header">
                                <div id="reader-title" class="reader-title">Post Title</div>
                                <div class="reader-meta">
                                    <span id="reader-date">üìÖ Date</span>
                                    <span id="reader-stats" class="meta-tag"># Stats</span>
                                </div>
                            </div>
                            <div id="reader-body" class="reader-content">
                                <!-- Full content goes here -->
                            </div>

                            <!-- Comments Section -->
                            <div class="comments-section">
                                <div class="comments-header">Discussion</div>
                                
                                <div id="comments-container" class="comment-list">
                                    <!-- Comments injected here -->
                                </div>

                                <div id="comment-form-container">
                                    <!-- Logged In: Show Form -->
                                    <div id="active-comment-form" class="comment-form">
                                        <textarea id="new-comment-text" rows="3" placeholder="Write a thoughtful comment..."></textarea>
                                        <button class="btn-ice" onclick="submitComment()">Post Comment</button>
                                    </div>
                                    <!-- Logged Out: Show Prompt -->
                                    <div id="login-prompt" class="login-prompt">
                                        <p>Please <strong style="cursor:pointer; text-decoration:underline;" onclick="showPage('login')">login</strong> to join the discussion.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CONTACT TAB -->
            <div id="contact" class="page-section">
                <div class="glass tilt-card" style="padding: 40px; max-width: 600px; margin: 0 auto;">
                    <h2 style="text-align: center; margin-bottom: 30px;">Contact</h2>

                    <!-- DIRECT CONNECT -->
                    <div style="background: var(--glass-highlight); padding: 15px; border-radius: 8px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--glass-border);">
                        <div style="display: flex; gap: 12px; align-items: center;">
                            <span style="font-size: 1.4rem;">üëæ</span>
                            <div>
                                <div style="font-size: 0.7rem; color: var(--text-secondary); font-weight: 700; letter-spacing: 0.5px;">DISCORD</div>
                                <div style="font-weight: 600; font-size: 0.95rem; color: var(--text-primary);">blueiceyt</div>
                            </div>
                        </div>
                        <button class="btn-ice" style="padding: 6px 12px; font-size: 0.75rem;" onclick="copyText('blueiceyt')">COPY</button>
                    </div>

                    <div style="background: var(--glass-highlight); padding: 15px; border-radius: 8px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--glass-border);">
                        <div style="display: flex; gap: 12px; align-items: center;">
                            <span style="font-size: 1.4rem;">üìß</span>
                            <div>
                                <div style="font-size: 0.7rem; color: var(--text-secondary); font-weight: 700; letter-spacing: 0.5px;">EMAIL</div>
                                <div style="font-weight: 600; font-size: 0.95rem; color: var(--text-primary);">hello@blueiceprojects.com</div>
                            </div>
                        </div>
                        <button class="btn-ice" style="padding: 6px 12px; font-size: 0.75rem;" onclick="copyText('hello@blueiceprojects.com')">COPY</button>
                    </div>
                    
                    <!-- FORM -->
                    <div style="opacity: 0.7; pointer-events:none;">
                        <input type="text" placeholder="Name">
                        <input type="text" placeholder="Email">
                        <textarea rows="5" placeholder="Message"></textarea>
                        <button class="btn-ice" style="width: 100%;">Send Message (Unavailable)</button>
                    </div>
                    <p style="font-size: 0.8rem; color: var(--text-secondary); text-align: center; margin-top: 10px;">Please use Email or Discord above.</p>
                </div>
            </div>

            <!-- LOGIN PAGE -->
            <div id="login" class="page-section">
                <div class="glass tilt-card login-card">
                    <h2 style="margin-bottom: 20px; color: var(--text-primary);">Login or Sign up</h2>
                    
                    <!-- LOGIN VIEW -->
                    <div id="view-login">
                        <button class="btn-google" onclick="signInGoogle()">
                            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="google-icon" alt="G">
                            Sign in with Google
                        </button>
                        
                        <div style="margin: 15px 0; font-size: 0.8rem; color: var(--text-secondary);">OR USE EMAIL</div>
                        
                        <input type="email" id="login-email" placeholder="Email" style="margin-bottom: 15px;">
                        <input type="password" id="login-pass" placeholder="Password" style="margin-bottom: 20px;">
                        <button class="btn-ice" style="width:100%; padding: 12px; margin-bottom: 15px;" onclick="signInEmail()">Login</button>
                        
                        <p style="font-size:0.9rem; color:var(--text-cyan);">
                            No account? <span style="color:var(--accent-cyan); cursor:pointer; text-decoration:underline;" onclick="toggleAuthView('signup')">Sign Up</span>
                        </p>
                    </div>

                    <!-- SIGNUP VIEW (UPDATED WITH GOOGLE) -->
                    <div id="view-signup" style="display:none;">
                        <button class="btn-google" onclick="signInGoogle()">
                            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="google-icon" alt="G">
                            Sign up with Google
                        </button>
                        <div style="margin: 15px 0; font-size: 0.8rem; color: var(--text-secondary);">OR CREATE ACCOUNT</div>

                        <input type="email" id="signup-email" placeholder="Email" style="margin-bottom: 15px;">
                        <input type="password" id="signup-pass" placeholder="Password (6+ chars)" style="margin-bottom: 20px;">
                        <button class="btn-ice" style="width:100%; padding: 12px; margin-bottom: 15px;" onclick="signUpEmail()">Sign Up</button>
                        
                        <p style="font-size:0.9rem; color:var(--text-secondary);">
                            Have an account? <span style="color:var(--accent-cyan); cursor:pointer; text-decoration:underline;" onclick="toggleAuthView('login')">Back to Login</span>
                        </p>
                    </div>
                    
                    <!-- LOGGED IN VIEW -->
                    <div id="view-profile" style="display:none;">
                        <h3 style="margin-bottom:15px;">Welcome Back!</h3>
                        <p id="profile-email" style="margin-bottom:20px; color:var(--accent-cyan);">user@example.com</p>
                        
                        <!-- ADMIN ONLY: Upload Tool -->
                        <div id="admin-panel" style="display:none;">
                            <button id="btn-admin-upload" class="btn-ice" style="width:100%; padding: 12px; margin-bottom:15px; border-color:#eab308; color:#eab308;" onclick="confirmUpload()">
                                ‚ö†Ô∏è ADMIN: Upload Static Data to Cloud
                            </button>
                        </div>

                        <!-- USER DASHBOARD -->
                        <div id="user-dashboard" style="display:none; text-align:left; background:var(--glass-highlight); padding:15px; border-radius:8px; border:1px solid var(--glass-border); margin-bottom:20px;">
                            <div style="font-weight:700; margin-bottom:10px; color:var(--accent-cyan);">My Account</div>
                            <ul style="list-style:none; padding:0; font-size:0.9rem;">
                                <li onclick="showDashboardSection('settings')" style="padding:8px 0; border-bottom:1px solid var(--glass-border); cursor:pointer;">‚öôÔ∏è Account Settings</li>
                                <li onclick="showDashboardSection('comments')" style="padding:8px 0; border-bottom:1px solid var(--glass-border); cursor:pointer;">üí¨ My Comments</li>
                                <li onclick="showDashboardSection('saved')" style="padding:8px 0; cursor:pointer;">‚ù§Ô∏è Saved Posts</li>
                            </ul>
                            
                            <!-- CONTENT AREA FOR TABS -->
                            <div id="dashboard-content" style="margin-top:20px; border-top:1px solid var(--glass-border); padding-top:15px; display:none;">
                                <!-- Dynamic Content injected here -->
                            </div>
                        </div>

                        <button class="btn-ice" style="width:100%; padding: 12px;" onclick="performLogout()">Logout</button>
                    </div>
                </div>
            </div>

        </main>

        <!-- GLOBAL RIGHT SIDEBAR (Always Visible) -->
        <aside>
            <div class="glass tilt-card sidebar-widget">
                <div class="sidebar-header">STATUS</div>
                <div class="char-display">
                    <img id="char-avatar" src="hairflow.gif" alt="Status Avatar" onerror="this.onerror=null;this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMCIiIGZpbGw9IiMzMzMiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSI1MCI+8J+RgjwvdGV4dD48L3N2Zz4=';">
                </div>
                <div style="margin-top: 15px; font-size: 0.85rem; color: var(--text-secondary); text-align: center;">
                    Yoshio Kabayashi from <em>Trickster</em>
                </div>
            </div>
            <div class="glass tilt-card sidebar-widget">
                <div class="sidebar-header">LINKS</div>
                <ul class="pixel-list">
                    <li onclick="showPage('projects')"><span class="px-icon"></span> My Works</li>
                    <li onclick="showPage('blog')"><span class="px-icon"></span> Journal</li>
                    <li><span class="px-icon"></span> <a href="https://discord.gg/FC5E9WJRzE" target="_blank">Discord Server</a></li>
                </ul>
            </div>
        </aside>
    </div>

    <!-- FOOTER -->
    <footer style="text-align: center; padding: 40px; color: var(--text-secondary); font-size: 0.85rem;">
        <p>&copy; 2025 Blue Ice. Clean & Functional.</p>
    </footer>

    <!-- FIREBASE MODULE -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, signInAnonymously, signInWithCustomToken, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, addDoc, query, orderBy, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ==========================================
        //  PASTE YOUR FIREBASE CONFIG HERE üëá
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyBOd4FbQg20MGV6Moy10j3beeCmFgoazn8",
            authDomain: "blue-ice-website.firebaseapp.com",
            projectId: "blue-ice-website",
            storageBucket: "blue-ice-website.firebasestorage.app",
            messagingSenderId: "928464189864",
            appId: "1:928464189864:web:f724346e9115314a23059d"
        };
        // ==========================================

        let auth, db;
        try {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            console.log("Firebase Initialized");
        } catch (e) {
            console.warn("Firebase config missing or invalid.");
        }

        // --- NEW: INITIALIZATION WITH AUTH ---
        async function initApp() {
            if (!auth) {
                // Fallback if auth not initialized (config missing)
                if(window.loadDynamicContent) window.loadDynamicContent();
                return;
            }

            try {
                // Check if we have a custom token from the environment (Immersive Canvas specific)
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    // Standard fallback: Anonymous auth ensures we have permissions to read public data
                    await signInAnonymously(auth);  
                }
            } catch (e) {
                console.warn("Auto-auth failed (Check if Anonymous Auth is enabled in Firebase Console):", e);
            }

            // Load data ONLY after auth attempt
            if(window.loadDynamicContent) window.loadDynamicContent();
        }

        // --- AUTH FUNCTIONS ---
        window.signInGoogle = async () => {
            if (!auth) return window.showMessage("Please configure Firebase first!", true);
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
                window.showMessage("Signed in with Google!");
                window.showPage('home');
            } catch (error) { window.showMessage(error.message, true); }
        };

        window.signInEmail = async () => {
            if (!auth) {
                // Fallback Simulation
                window.currentUser = document.getElementById('login-email').value || "Guest";
                window.updateUIForLogin(window.currentUser);
                window.showMessage("Signed in as Guest (Offline Mode).");
                window.showPage('home');
                return;
            }
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            try {
                await signInWithEmailAndPassword(auth, email, pass);
                window.showMessage("Signed in!");
                window.showPage('home');
            } catch (error) { window.showMessage(error.message, true); }
        };

        window.signUpEmail = async () => {
            if (!auth) return window.showMessage("Please configure Firebase first!", true);
            const email = document.getElementById('signup-email').value;
            const pass = document.getElementById('signup-pass').value;
            try {
                await createUserWithEmailAndPassword(auth, email, pass);
                window.showMessage("Account created and signed in!");
                window.showPage('home');
            } catch (error) { window.showMessage(error.message, true); }
        };

        window.performLogout = async () => {
            if (auth) {
                await signOut(auth);
                window.showMessage("Logged out successfully.");
            }
            else {
                window.currentUser = null;
                window.updateUIForLogout();
                window.showMessage("Logged out from guest session.");
            }
        };

        window.resetPassword = async () => {
            if(!auth || !auth.currentUser) return window.showMessage("You must be logged in to reset password.", true);
            const email = auth.currentUser.email;
            if(!email) return window.showMessage("No email found.", true);
            
            // Firebase can only reset passwords for Email/Password users, not Google/Anonymous
            if (auth.currentUser.providerData.some(p => p.providerId === 'password')) {
                try {
                    await sendPasswordResetEmail(auth, email);
                    window.showMessage(`Password reset email sent to ${email}`);
                } catch(e) {
                    window.showMessage("Error sending email: " + e.message, true);
                }
            } else {
                window.showMessage("Password reset is only available for accounts created with Email/Password.", true);
            }
        }

        // --- DYNAMIC CONTENT FETCHING ---
        window.loadDynamicContent = async () => {
            if (!db) {
                console.log("Using static fallback data.");
                window.renderProjects(window.staticProjectData);
                window.renderBlogFeed(window.staticBlogPosts);
                return;
            }

            try {
                // Projects
                const projSnapshot = await getDocs(query(collection(db, "projects")));
                const projects = projSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                // Blog Posts
                const blogSnapshot = await getDocs(query(collection(db, "posts"), orderBy("date", "desc")));
                const posts = blogSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                // If DB empty, fallback to static
                if(projects.length === 0) window.renderProjects(window.staticProjectData);
                else window.renderProjects(projects);

                if(posts.length === 0) window.renderBlogFeed(window.staticBlogPosts);
                else {
                    window.liveBlogPosts = posts; // Store for reader
                    window.renderBlogFeed(posts);
                }

            } catch (e) {
                console.error("Error fetching data:", e);
                // Fallback
                window.renderProjects(window.staticProjectData);
                window.renderBlogFeed(window.staticBlogPosts);
            }
        };
        
        // Function to fetch comments for a specific post
        window.fetchComments = async (postId) => {
            if (!db || !postId || postId.startsWith('static_')) return [];

            try {
                const commentsRef = collection(db, "posts", postId, "comments");
                // Fetch comments ordered by timestamp
                const commentsSnapshot = await getDocs(query(commentsRef, orderBy("timestamp", "asc")));
                
                return commentsSnapshot.docs.map(doc => {
                    const data = doc.data();
                    // Format timestamp
                    const time = data.timestamp ? new Date(data.timestamp).toLocaleString() : 'N/A';
                    return { ...data, time: time };
                });

            } catch(e) {
                console.error(`Error fetching comments for post ${postId}:`, e);
                return [];
            }
        }

        // --- ADMIN TOOL: UPLOAD STATIC TO DB ---
        window.module_uploadStaticToFirebase = async () => {
            if (!db) return window.showMessage("Database not connected.", true);
            
            try {
                // Upload Projects
                for (const p of window.staticProjectData) {
                    await setDoc(doc(collection(db, "projects")), p); // Use setDoc to create docs with random IDs
                }
                // Upload Blogs
                for (const b of window.staticBlogPosts) {
                    // Remove ID (let Firestore gen it) and comments (optional)
                    const { id, comments, ...postData } = b;  
                    await setDoc(doc(collection(db, "posts")), postData);
                }
                window.showMessage("Upload Complete! Refresh the page to see live data.", false);
            } catch (e) {
                window.showMessage("Error uploading: " + e.message, true);
            }
        };

        // --- ADMIN CONFIRM WRAPPER (Replaces old confirm()) ---
        window.confirmUpload = () => {
            window.showConfirmation("This will upload all static blogs and projects to your database. Continue?", async (result) => {
                if (result) {
                    await window.module_uploadStaticToFirebase();
                } else {
                    window.showMessage("Upload cancelled.", true);
                }
            });
        }
        
        // --- COMMENT SUBMISSION (FIXED TO SAVE TO FIREBASE) ---
        window.module_submitComment = async (txt) => {
            if (!db) return window.showMessage("Database not connected. Comment not saved.", true);
            if (!window.currentUser || window.authUser.isAnonymous) return window.showMessage("Please log in with a registered account to post comments.", true);
            if (!window.currentPostId || window.currentPostId.startsWith('static_')) return window.showMessage("Cannot comment on static posts. Please upload posts to Firebase first.", true);

            const text = txt.trim();
            if (!text) return;

            try {
                const postRef = doc(db, "posts", window.currentPostId);
                const commentsCollectionRef = collection(postRef, "comments");

                await addDoc(commentsCollectionRef, {
                    user: window.currentUser,
                    text: text,
                    timestamp: new Date().toISOString(), // Use client timestamp for simple sorting
                    userId: window.authUser.uid
                });
                
                document.getElementById('new-comment-text').value = "";
                
                // --- INSTANT UI UPDATE ---
                // Fetch and re-render the comments immediately to show the new one
                const freshComments = await window.fetchComments(window.currentPostId);
                const post = window.liveBlogPosts.find(p => p.id === window.currentPostId);
                if(post) post.comments = freshComments; // Update the stored version
                window.renderComments(post);

                window.showMessage("Comment posted successfully!");
                
            } catch (e) {
                console.error("Error saving comment:", e);
                window.showMessage("Failed to save comment. Check Firebase rules to allow writes to posts/{postId}/comments.", true);
            }
        };

        // --- AUTH LISTENER ---
        if (auth) {
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    const name = user.displayName || user.email.split('@')[0];
                    window.currentUser = name;
                    // Expose auth user for dashboard logic
                    window.authUser = user;  
                    window.updateUIForLogin(user.email);
                } else {
                    window.currentUser = null;
                    window.authUser = null;
                    window.updateUIForLogout();
                }
            });
        }

        window.updateUIForLogin = (email) => {
            document.getElementById('nav-login-btn').innerText = "Account";
            document.getElementById('view-login').style.display = 'none';
            document.getElementById('view-signup').style.display = 'none';
            document.getElementById('view-profile').style.display = 'block';
            document.getElementById('profile-email').innerText = email;
            
            // Logic for Admin vs User
            if (email === 'archan.s.bhatt@gmail.com') {
                document.getElementById('admin-panel').style.display = 'block';
                document.getElementById('user-dashboard').style.display = 'none';
            } else {
                document.getElementById('admin-panel').style.display = 'none';
                document.getElementById('user-dashboard').style.display = 'block';
            }

            if(window.updateCommentFormVisibility) window.updateCommentFormVisibility();
        }

        window.updateUIForLogout = () => {
            document.getElementById('nav-login-btn').innerText = "Login";
            document.getElementById('view-login').style.display = 'block';
            document.getElementById('view-profile').style.display = 'none';
            if(window.updateCommentFormVisibility) window.updateCommentFormVisibility();
        }

        // Start App
        initApp();
    </script>

    <!-- STANDARD JS LOGIC -->
    <script>
        // --- 1. GLOBAL STATE & UTILITIES ---
        window.currentPostId = null; // Changed to window property for module access
        window.liveBlogPosts = []; // Will hold DB posts
        let globalConfirmCallback = null;

        // Allowed paths for URL routing
        const VALID_ROUTES = ['home', 'projects', 'blog', 'contact', 'login'];

        // Message/Alert replacement
        window.showMessage = (text, isError = false) => {
            const box = document.getElementById('message-box');
            box.innerText = text;
            box.style.background = isError ? 'var(--error-red)' : 'var(--accent-blue)';
            box.style.display = 'block';
            box.style.opacity = '1';
            setTimeout(() => {
                box.style.opacity = '0';
                setTimeout(() => box.style.display = 'none', 500);
            }, 3000);
        }

        // Confirm replacement
        window.showConfirmation = (message, callback) => {
            globalConfirmCallback = callback;
            document.getElementById('confirm-message').innerText = message;
            document.getElementById('confirm-modal').style.display = 'flex';
        }

        window.confirmCallback = (result) => {
            document.getElementById('confirm-modal').style.display = 'none';
            if (globalConfirmCallback) {
                globalConfirmCallback(result);
            }
            globalConfirmCallback = null;
        }

        // STATIC FALLBACK DATA (Used if DB is empty or offline)
        window.staticProjectData = [
            { title: "Neon Dashboard UI Demo", description: "Data visualization concept.", videoID: "Qd974r58B1s" },
            { title: "Synth Wave Audio Engine", description: "Browser-based music creation.", videoID: "pW_S40R47g4" },
            { title: "Adaptive Portfolio Design", description: "Responsive mobile testing.", videoID: "6I-9V2Q4vW8" }
        ];

        window.staticBlogPosts = [
            // --- TUTORIAL POST (HOW TO USE MARKDOWN & IMAGES) ---
            {
                id: "static_0", 
                title: "How to Write in Markdown", 
                date: "2025-12-11",
                category: "Guide",
                excerpt: "Learn how to format your posts easily with Markdown!",
                
                // --- HOW TO CHANGE COVER IMAGE ---
                // 1. Find the 'image' line below.
                // 2. Paste your image link inside the quotes "..."
                // 3. If you want an emoji instead, remove this line and use emoji: "üòé"
                image: "https://placehold.co/600x400/2563eb/fff?text=Markdown+Tutorial", 
                
                // --- WRITING IN MARKDOWN ---
                // You can now use simple symbols!
                content: `
# This is a Main Heading
## This is a Subheading

You can write normal text here. It is **much easier** than writing HTML tags.

### Lists are easy:
- Item one
- Item two
- Item three

### Adding Images
Just use this format: 
\`![Image Description](YOUR_IMAGE_LINK_HERE)\`

![Example Image](https://placehold.co/600x300/0891b2/fff?text=Markdown+Image+Example)

### Quotes
> "This is a blockquote. It looks stylish automatically."

Happy writing!
                `,
                comments: []
            },
            
            // --- OLD POSTS ---
            {
                id: "static_1",
                title: "Returning to Simplicity",
                date: "2025-12-09",
                category: "Engineering",
                excerpt: "Stripping back aesthetics for cleaner looks.",
                image: "https://placehold.co/400x350/0891b2/fff?text=Design+Post",
                content: `In a world of maximalist design, sometimes the best solution is to strip everything back to the essentials. This principle is especially true in web development, where speed and accessibility are paramount. By favoring clean lines and high contrast, we ensure the user's focus remains on the content. Less glitter, more meaning.

### Why Less is More

Minimalist interfaces lead to faster load times and reduced cognitive load for the user. Every element must earn its place on the screen. We focus on utility over decoration, making every interaction intuitive and efficient.`,  
                comments: []
            },
            {
                id: "static_2",
                title: "The Void Aesthetic",
                date: "2025-12-01",
                category: "Personal",
                excerpt: "Deep blue gradients in UI design.",
                image: "https://placehold.co/400x350/020617/fff?text=Dark+Mode+Vibe",
                content: `There is something inherently calming about the void aesthetic, particularly when using deep, saturated blues. It provides a visual depth that traditional dark modes often lack. This design choice is not just about reducing eye strain; it's about creating an atmosphere.

### Creating Depth

We use subtle ambient light effects and blurred orbs (as seen in the background of this site!) to provide structure without being distracting. The challenge is balancing the darkness so that text remains crisp and readable, especially on high-resolution screens.`,
                comments: []
            }
        ];

        // REDUCED TO 13 IMAGES
        const marqueeImages = [
            "image1.jpg", "image2.jpg", "image3.jpg", "image4.jpg", "image5.jpg",
            "image6.jpg", "image7.jpg", "image8.jpg", "image9.jpg", "image10.jpg",
            "image11.jpg", "image12.jpg", "image13.jpg"
        ];

        // --- 2. UTILS & UI ---
        function toggleAuthView(view) {
            document.getElementById('view-login').style.display = (view === 'login' ? 'block' : 'none');
            document.getElementById('view-signup').style.display = (view === 'signup' ? 'block' : 'none');
        }

        function toggleTheme() {
            const body = document.body;
            const btn = document.querySelector('.theme-toggle-btn');
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                btn.innerHTML = '‚òæ';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                btn.innerHTML = '‚òÄ';
                localStorage.setItem('theme', 'dark');
            }
        }

        // --- NEW: DEDICATED BACK FUNCTION ---
        // Forces the reader to close and resets URL, avoiding router logic issues
        window.goBackToJournal = () => {
            closeReader();
            // Update URL to /blog
            history.pushState({ id: 'blog' }, '', '/blog');
            // Ensure visual state is correct (highlight nav, etc) without pushing history again
            showPage('blog', false); 
            // Scroll to top of list
            window.scrollTo({top:0, behavior:'smooth'});
        }

        function showPage(id, updateHistory = true) {
            
            // Validate and determine the final route ID
            let routeId = id;
            
            // Check if the path is /blog/postID, if so, the container is 'blog'
            const pathParts = id.split('/');
            if (pathParts.length > 1 && pathParts[0] === 'blog') {
                routeId = 'blog';
            } else if (!VALID_ROUTES.includes(id)) {
                routeId = 'home';
            }

            // --- OPTIMIZED TRANSITION LOGIC ---
            // Check if we are already viewing this section (e.g., clicking "Back to Journal" while on "Blog")
            const currentSection = document.querySelector('.page-section.active');
            const isSameSection = currentSection && currentSection.id === routeId;

            if (!isSameSection) {
                // Only run the fade-in animation/scroll if we are changing pages
                window.scrollTo({top:0, behavior:'smooth'});
                document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
                // Delay to allow CSS animation to trigger properly
                setTimeout(() => document.getElementById(routeId).classList.add('active'), 50);
            }
            
            document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
            const navId = VALID_ROUTES.includes(routeId) ? routeId : 'home';
            const link = document.getElementById('nav-'+navId);
            if(link) link.classList.add('active');

            // Update URL using History API
            if (updateHistory) {
                // If the user clicked a link (e.g., 'projects'), we update the path
                let path = (id === 'home' ? '/' : '/' + id);
                history.pushState({ id: routeId }, '', path);
            }
            
            // --- FIXED: READER CLOSING LOGIC ---
            // If we navigate to the main 'blog' page (not a specific post), close the reader.
            if (id === 'blog' || routeId !== 'blog') {
                 closeReader();
            }
        }

        // Function run on initial load or browser navigation (back/forward)
        function handleInitialRoute() {
            // *** FIX: Check for redirected path from 404.html first ***
            const redirectedPath = sessionStorage.getItem('redirectPath');
            sessionStorage.removeItem('redirectPath'); // Clear it immediately

            // Use redirected path if present, otherwise use current window location
            let path = redirectedPath ? redirectedPath.substring(1) : window.location.pathname.substring(1);
            
            // Handle cases where path is a GitHub project sub-directory path (e.g. /my-repo/projects)
            // This logic is safer if the site is not hosted on a custom domain/root user page
            if (path.includes('/') && path.split('/').length > 1) {
                 // Assumes first segment is the repo name if not in a user/org root repo
                 // For now, we rely on the host handling the path correctly after the root is loaded.
            }

            const pathSegments = path.split('/');
            let routeId;
            
            // --- DEFENSIVE ROUTE RESOLUTION FIX ---
            // If the path is empty or equivalent to the root path (""), explicitly set routeId to 'home'.
            if (path === "" || path === "/") {
                routeId = 'home';
            } else {
                routeId = pathSegments[0];
            }
            
            if (VALID_ROUTES.includes(routeId)) {
                // IMPORTANT: The second argument is false, so showPage does NOT push a new URL
                showPage(routeId, false); 

                // Handle deep link into blog post (e.g., /blog/post_id)
                if (routeId === 'blog' && pathSegments.length > 1 && pathSegments[1]) {
                    // Open the specific post if an ID is present
                    openReader(pathSegments[1]);  
                }
            } else {
                // If the route is not valid (e.g., a file that doesn't exist, or just the repo name)
                showPage('home', false); 
            }
        }

        // Listen for browser back/forward buttons
        window.addEventListener('popstate', (e) => {
              handleInitialRoute();
        });


        function copyText(text) {
            // Using modern clipboard API which works on HTTPS/secure contexts
            navigator.clipboard.writeText(text)
                .then(() => window.showMessage("Copied!"))
                .catch(() => {
                    // Fallback to manual copy (or use execCommand, but it's deprecated)
                    window.showMessage("Manual Copy: " + text, true);
                });
        }

        function calculateReadStats(htmlContent) {
            const text = htmlContent.replace(/<[^>]*>?/gm, '');
            const wordCount = text.trim().split(/\s+/).length;
            const readTime = Math.ceil(wordCount / 200);
            return { count: wordCount, time: readTime };
        }

        // --- 3. RENDERERS ---
        window.renderProjects = (projects) => {
            const grid = document.getElementById('projects-grid');
            grid.innerHTML = "";
            projects.forEach(p => {
                grid.innerHTML += `
                    <div class="glass tilt-card project-card-video">
                        <div class="video-container"><iframe src="https://www.youtube-nocookie.com/embed/${p.videoID}?controls=0" title="${p.title}" frameborder="0" allowfullscreen></iframe></div>
                        <h3>${p.title}</h3><p style="font-size:0.9rem; color:var(--text-secondary);">${p.description}</p>
                    </div>`;
            });
        }

        function renderMarquee() {
            const track = document.getElementById('marquee-track');
            track.innerHTML = "";
            [...marqueeImages, ...marqueeImages].forEach((img, i) => {
                const fallback = `data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyODAiIGhlaWdodD0iMTIwIiB2aWV3Qm94PSIwIDAgMjgwIDEyMCI+PHJlY3Qgd2lkdGg9IjI4MCIgaGVpZ2h0PSIxMjAiIGZpbGw9IiMzMzMiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIyMCIgZmlsbD0iI2ZmZiI+SW1hZ2UgI2ZhbGxiYWNrPC90ZXh0Pjwvc3ZnPg==`;
                track.innerHTML += `<div class="marquee-item"><img src="${img}" onerror="this.src='${fallback}'"></div>`;
            });
        }

        window.renderBlogFeed = (posts) => {
            const list = document.getElementById('blog-list');
            list.innerHTML = "";
            posts.forEach(p => {
                const stats = calculateReadStats(p.content);
                
                let thumbContent;
                if (p.image) {
                    thumbContent = `<img src="${p.image}" alt="${p.title}" onerror="this.onerror=null;this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMTQwIiB2aWV3Qm94PSIwIDAgMjgwIDE0MCI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIxNDAiIGZpbGw9IiMzMzMiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIyMCIgZmlsbD0iI2ZmZiI+Q292ZXIgSW1hZ2U8L3RleHQ+PC9zdmc+'" style="width:100%; height:100%; object-fit:cover;">`;
                } else {
                    thumbContent = p.emoji || 'üìÑ';
                }

                const div = document.createElement('div');
                div.className = "glass tilt-card post-card-horiz";
                div.onclick = () => openReader(p.id);
                div.innerHTML = `
                    <div class="post-info">
                        <div class="post-meta-row"><span>üìÖ ${p.date}</span><span class="meta-tag"># ${p.category}</span></div>
                        <h3 class="post-title-lg">${p.title}</h3><p class="post-excerpt-sm">${p.excerpt}</p>
                        <div class="post-stats">${stats.count} words | ${stats.time} min read</div>
                    </div><div class="post-thumb-rect">${thumbContent}</div>`;
                list.appendChild(div);
            });
        }

        // --- 4. READER & COMMENTS ---
        async function openReader(id) {
            window.currentPostId = id;
            
            let post = window.liveBlogPosts.find(p => p.id === id) || window.staticBlogPosts.find(p => p.id === id);
            
            if(!post) return;
            
            // --- UPDATED: PARSE MARKDOWN ---
            // We now pass the content through marked.parse() to convert Markdown to HTML
            const markdownContent = post.content || "";
            const htmlContent = marked.parse(markdownContent);
            
            const stats = calculateReadStats(htmlContent); // stats calculated on final HTML
            
            document.getElementById('reader-title').innerText = post.title;
            document.getElementById('reader-date').innerText = "üìÖ " + post.date;
            document.getElementById('reader-stats').innerText = `${stats.count} words ‚Ä¢ ${stats.time} min read`;
            
            // Inject the parsed HTML
            document.getElementById('reader-body').innerHTML = htmlContent;
            
            // Handle Cover Image
            const coverImg = document.getElementById('reader-cover');
            if (post.image) {
                coverImg.src = post.image;
                coverImg.style.display = 'block';
            } else {
                coverImg.style.display = 'none';
            }
            
            // --- FETCH COMMENTS ON OPEN (If not static) ---
            if (!id.startsWith('static_') && window.fetchComments) {
                const freshComments = await window.fetchComments(id);
                post.comments = freshComments; // Update comments on the post object
            }
            
            renderComments(post);
            window.updateCommentFormVisibility();  
            updateSaveButtonState(); // Update save button state on open

            document.getElementById('blog-list').style.display = 'none';
            document.getElementById('blog-reader').style.display = 'block';
            
            // Update URL for deep linking
            history.pushState({ id: 'blog', postId: id }, '', '/blog/' + id);
            document.getElementById('blog').scrollIntoView({behavior: 'smooth'});
        }

        function closeReader() {
            document.getElementById('blog-reader').style.display = 'none';
            document.getElementById('blog-list').style.display = 'block';
            window.currentPostId = null;
            // When closing the reader, make sure to hide dashboard content
            const dashboardContent = document.getElementById('dashboard-content');
            if (dashboardContent) dashboardContent.style.display = 'none';
            
            // REMOVED: history.pushState({ id: 'blog' }, '', '/blog');
            // This URL manipulation is now handled by the 'Back to Journal' button calling showPage('blog')
        }

        function renderComments(post) {
            const container = document.getElementById('comments-container');
            container.innerHTML = "";
            const comments = post.comments || [];
            
            if(comments.length === 0) {
                container.innerHTML = `<div style="font-style:italic; opacity:0.7;">No comments yet.</div>`;
                return;
            }
            comments.forEach(c => {
                // If timestamp is ISO string, format it
                const timeDisplay = c.timestamp ? new Date(c.timestamp).toLocaleString() : c.time || 'N/A';
                
                container.innerHTML += `
                    <div class="comment-item">
                        <div class="comment-user">${c.user}</div>
                        <div class="comment-text">${c.text}</div>
                        <div class="comment-time">${timeDisplay}</div>
                    </div>`;
            });
        }

        window.updateCommentFormVisibility = () => {
            const form = document.getElementById('active-comment-form');
            const prompt = document.getElementById('login-prompt');
            if (window.currentUser && window.authUser && !window.authUser.isAnonymous) {
                form.style.display = 'block';
                prompt.style.display = 'none';
            } else {
                form.style.display = 'none';
                prompt.style.display = 'block';
            }
        };

        window.submitComment = async () => {
            const txt = document.getElementById('new-comment-text').value.trim();
            if(!txt) return;
            
            if (window.module_submitComment) {
                await window.module_submitComment(txt);
            } else {
                window.showMessage(`Cannot save comment. Firebase Module is not loaded or configured.`, true);
                document.getElementById('new-comment-text').value = "";
            }
        };

        // --- 5. DASHBOARD & SAVING LOGIC ---
        
        function toggleSavePost() {
            if(!window.currentPostId) return;
            let saved = JSON.parse(localStorage.getItem('blueice_saved')) || [];
            const index = saved.indexOf(window.currentPostId);
            
            if(index > -1) {
                saved.splice(index, 1);
                window.showMessage("Removed from Saved Posts.");
            } else {
                saved.push(window.currentPostId);
                window.showMessage("Post Saved!");
            }
            localStorage.setItem('blueice_saved', JSON.stringify(saved));
            updateSaveButtonState();
        }

        function updateSaveButtonState() {
            const btn = document.getElementById('btn-save-post');
            if(!window.currentPostId) return;
            let saved = JSON.parse(localStorage.getItem('blueice_saved')) || [];
            
            if(saved.includes(window.currentPostId)) {
                btn.innerHTML = "‚ù§Ô∏è Saved";
                btn.style.borderColor = "var(--accent-cyan)";
                btn.style.color = "var(--accent-cyan)";
            } else {
                btn.innerHTML = "ü§ç Save";
                btn.style.borderColor = "var(--glass-border)";
                btn.style.color = "var(--text-primary)";
            }
        }

        function showDashboardSection(section) {
            const container = document.getElementById('dashboard-content');
            container.style.display = 'block';
            container.innerHTML = '';

            if(section === 'settings') {
                container.innerHTML = `
                    <div style="margin-bottom:15px; font-weight:700;">Account Details</div>
                    <div style="font-size:0.9rem; color:var(--text-secondary); margin-bottom:5px;">Email: ${window.authUser?.email}</div>
                    <div style="font-size:0.9rem; color:var(--text-secondary); margin-bottom:15px;">User ID: ${window.authUser?.uid}</div>
                    <button class="btn-ice" onclick="resetPassword()" style="font-size:0.8rem;">Send Password Reset Email</button>
                `;
            } else if(section === 'comments') {
                // Find comments by this user
                let myComments = [];
                // Combine lists to search
                const allPosts = [...window.liveBlogPosts, ...window.staticBlogPosts];
                // Dedupe roughly by ID
                const uniquePosts = Array.from(new Map(allPosts.map(item => [item.id, item])).values());

                uniquePosts.forEach(post => {
                    if(post.comments) {
                        post.comments.forEach(c => {
                            // Using the email check as a proxy for identifying user's comments
                            if(window.authUser && c.userId === window.authUser.uid) { 
                                myComments.push({ postTitle: post.title, text: c.text, postId: post.id });
                            }
                        });
                    }
                });

                if(myComments.length === 0) {
                    container.innerHTML = `<div style="font-style:italic; opacity:0.7;">You haven't commented on anything yet.</div>`;
                } else {
                    container.innerHTML = `<div style="margin-bottom:15px; font-weight:700;">Your Comments (Saved to Database)</div>`;
                    myComments.forEach(c => {
                        container.innerHTML += `
                            <div style="background:rgba(0,0,0,0.03); padding:10px; border-radius:6px; margin-bottom:10px; font-size:0.9rem;">
                                <div style="font-weight:600; margin-bottom:4px;">On "${c.postTitle}"</div>
                                <div style="font-style:italic;">"${c.text}"</div>
                                <div style="margin-top:5px; font-size:0.8rem; color:var(--accent-cyan); cursor:pointer;" onclick="showPage('blog'); openReader('${c.postId}')">Go to Post ‚Üí</div>
                            </div>
                        `;
                    });
                }

            } else if(section === 'saved') {
                const savedIds = JSON.parse(localStorage.getItem('blueice_saved')) || [];
                const allPosts = [...window.liveBlogPosts, ...window.staticBlogPosts];
                const uniquePosts = Array.from(new Map(allPosts.map(item => [item.id, item])).values());
                
                const savedPosts = uniquePosts.filter(p => savedIds.includes(p.id));

                if(savedPosts.length === 0) {
                    container.innerHTML = `<div style="font-style:italic; opacity:0.7;">No saved posts yet.</div>`;
                } else {
                    container.innerHTML = `<div style="margin-bottom:15px; font-weight:700;">Saved Articles</div>`;
                    savedPosts.forEach(p => {
                        container.innerHTML += `
                            <div style="display:flex; align-items:center; justify-content:space-between; padding:10px; border-bottom:1px solid var(--glass-border);">
                                <span style="font-weight:600; font-size:0.9rem;">${p.title}</span>
                                <button class="btn-ice" style="padding:4px 8px; font-size:0.75rem;" onclick="showPage('blog'); openReader('${p.id}')">Read</button>
                            </div>
                        `;
                    });
                }
            }
        }

        // --- 6. INIT ---
        window.addEventListener('load', () => {
            // Boot screen
            const bar = document.getElementById('boot-bar'); let w = 0;
            const int = setInterval(() => {
                w += Math.random() * 8; if(w > 100) w = 100; bar.style.width = w + "%";
                if(w === 100) {  
                    clearInterval(int);  
                    setTimeout(() => {  
                        document.getElementById('boot-screen').style.opacity = '0';  
                        setTimeout(() => {  
                            document.getElementById('boot-screen').style.display = 'none';  
                            typeWriter();  
                        }, 800);  
                    }, 500);  
                }
            }, 50);

            // DATA LOADING is handled by initApp in the module script above
            renderMarquee();
            
        });

        // Typewriter & Particles
        const txt = "Hi, I'm Archan."; let ti = 0;
        function typeWriter() {  
            const el = document.getElementById('typewriter');  
            if(ti < txt.length && el) {  
                el.innerHTML += txt.charAt(ti);  
                ti++;  
                setTimeout(typeWriter, 100);  
            } else {
                // FIXED: Call router only AFTER boot sequence is complete
                handleInitialRoute();
            }  
        }
        
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize); resize();
        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height;
                this.size = Math.random() * 2.5;
                this.speedX = (Math.random() - 0.5) * 1.5; this.speedY = (Math.random() - 0.5) * 1.5;
                this.opacity = Math.random() * 0.9 + 0.1;
            }
            update() {
                this.x += this.speedX; this.y += this.speedY;
                if (this.x > canvas.width) this.x = 0; if (this.x < 0) this.x = canvas.width;
                if (this.y > canvas.height) this.y = 0; if (this.y < 0) this.y = canvas.height;
            }
            draw() {
                const isDark = document.body.getAttribute('data-theme') === 'dark';
                ctx.fillStyle = isDark ? `rgba(34, 211, 238, ${this.opacity})` : `rgba(8, 145, 178, ${this.opacity})`;
                ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
            }
        }
        for (let i = 0; i < 80; i++) particles.push(new Particle());
        function animateParticles() { ctx.clearRect(0, 0, canvas.width, canvas.height); particles.forEach(p => { p.update(); p.draw(); }); requestAnimationFrame(animateParticles); }
        animateParticles();

        document.addEventListener('mousemove', (e) => {
            document.querySelectorAll('.tilt-card').forEach(card => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left; const y = e.clientY - rect.top;
                if (x > -50 && x < rect.width + 50 && y > -50 && y < rect.height + 50) {
                    const rotateX = ((y - rect.height/2) / 30) * -1;  
                    const rotateY = (x - rect.width/2) / 30;
                    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
                } else { card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0)'; }
            });
        });
    </script>
</body>
</html>
